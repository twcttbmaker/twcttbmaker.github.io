<!DOCTYPE html>
<html lang="en" class="h-full w-full">
  <head>
    <meta charset="UTF-8" />
    <title>TTC Timetable Block Maker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
      @font-face {
        font-family: "iOS-Font";
        src: url("SF-Pro-Display-Regular.otf") format("opentype");
        font-weight: normal;
        font-style: normal;
      }

      @font-face {
        font-family: "iOS-Font";
        src: url("SF-Pro-Display-Bold.otf") format("opentype");
        font-weight: bold;
        font-style: normal;
      }

      body {
        font-family: "iOS-Font", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
      }

      /* Prevent text selection on timetable preview */
      #timetablePreview * {
        user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }

      /* Draggable background styles */
      .draggable-background {
        cursor: grab;
      }

      .draggable-background:active {
        cursor: grabbing;
      }

      /* Custom slider styles */
      .slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 0.75rem;
        border-radius: 9999px;
        background: #e5e7eb;
        outline: none;
        transition: background 0.3s ease;
      }

      .slider:hover {
        background: #d1d5db;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 1.25rem;
        height: 1.25rem;
        border-radius: 9999px;
        background: #0ea5e9;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3);
        transition: background 0.2s ease, transform 0.1s ease;
      }

      .slider::-webkit-slider-thumb:hover {
        background: #0284c7;
        transform: scale(1.05);
      }

      .slider::-moz-range-thumb {
        width: 1.25rem;
        height: 1.25rem;
        border-radius: 9999px;
        background: #0ea5e9;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3);
        transition: background 0.2s ease, transform 0.1s ease;
      }

      .slider::-moz-range-thumb:hover {
        background: #0284c7;
        transform: scale(1.05);
      }

      .slider::-moz-range-track {
        height: 0.75rem;
        border-radius: 9999px;
        background: transparent;
      }

      /* Remove default Firefox outline on focus */
      .slider:focus {
        outline: none;
      }
    </style>
  </head>

  <body class="h-full w-full bg-slate-950 text-slate-100">
    <div class="min-h-screen flex flex-col">
      <!-- Top Banner -->
      <header class="border-b border-slate-800 bg-slate-900/80 backdrop-blur">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div
              class="h-9 w-9 rounded-xl bg-sky-500/10 border border-sky-500/30 flex items-center justify-center"
            >
              <span class="text-sky-400 text-lg font-semibold">TTB</span>
            </div>
            <div>
              <h1 class="text-base font-semibold text-slate-50">
                TTB Maker
                <span
                  class="inline-flex items-center gap-1 rounded-full bg-sky-500/10 px-2 py-0.5 text-[11px] font-medium text-sky-300 border border-sky-500/30 align-middle ml-1"
                >
                  <span
                    class="inline-block h-1.5 w-1.5 rounded-full bg-emerald-400"
                  ></span>
                  v1.04
                </span>
              </h1>
              <p class="text-xs text-slate-400">
                Generate timetables with the TWC Self-Service copy-paste hack
              </p>
            </div>
          </div>

          <div class="flex items-center gap-2 text-[11px] text-slate-400">
            <span class="hidden sm:inline">
              Updated 31 Dec 2024 ‚Ä¢ Created by TTB
            </span>
            <span
              class="inline-flex items-center gap-1 rounded-full bg-emerald-500/10 px-2 py-1 font-medium text-emerald-300 border border-emerald-500/30"
            >
              <span
                class="inline-block h-1.5 w-1.5 rounded-full bg-emerald-400"
              ></span>
              Works best on desktop
            </span>
          </div>
        </div>
      </header>

      <!-- Main Layout -->
      <main class="flex-1">
        <div class="max-w-6xl mx-auto px-4 py-4 space-y-4">
          <!-- Intro + Alerts -->
          <section class="grid gap-4 md:grid-cols-[minmax(0,2fr)_minmax(0,1.6fr)]">
            <!-- Left: Intro & Instructions -->
            <div class="space-y-3">
              <!-- Hero card -->
              <div
                class="relative overflow-hidden rounded-2xl border border-slate-800 bg-gradient-to-br from-slate-900 via-slate-950 to-slate-900"
              >
                <div
                  class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.12),transparent_55%)]"
                ></div>

                <div class="relative px-4 py-4 space-y-4">
                  <div class="flex items-start justify-between gap-3">
                    <div class="space-y-1">
                      <div
                        class="inline-flex items-center gap-1 rounded-full bg-sky-500/10 px-2 py-1 text-[11px] font-medium text-sky-300 border border-sky-500/30"
                      >
                        <span
                          class="inline-block h-1.5 w-1.5 rounded-full bg-sky-400"
                        ></span>
                        New: Save & load timetables
                      </div>
                      <h2 class="text-lg font-semibold text-slate-50">
                        ÂîîÊÉ≥ÂÜçÊéíÈöäÂïèËΩâÂîîËΩâÂà∞Ôºü
                      </h2>
                      <p class="text-xs text-slate-300">
                        TWC credit transfer database Âπ´‰Ω†‰∏ÄÊ¨°ÈÅéÁùáÊôí üî• TWC credit
                        transfer
                      </p>
                    </div>
                    <div class="hidden sm:flex flex-col items-end gap-1">
                      <span
                        class="inline-flex items-center gap-1 rounded-full bg-slate-900/80 px-2 py-1 text-[11px] text-slate-300 border border-slate-700/70"
                      >
                        <span
                          class="inline-block h-1.5 w-1.5 rounded-full bg-emerald-400"
                        ></span>
                        Online
                      </span>
                      <button
                        type="button"
                        onclick="window.open('https://forms.gle/uCsLxQ2H7Z6rc6zz6', '_blank')"
                        class="inline-flex items-center gap-1 rounded-full bg-sky-500/10 px-2 py-1 text-[11px] font-medium text-sky-300 border border-sky-500/30 hover:bg-sky-500/15 transition-colors"
                      >
                        TTB Feedback Form
                        <svg
                          class="w-3 h-3"
                          viewBox="0 0 20 20"
                          fill="none"
                          aria-hidden="true"
                        >
                          <path
                            d="M5 15L15 5M15 5H7M15 5V13"
                            stroke="currentColor"
                            stroke-width="1.4"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                        </svg>
                      </button>
                    </div>
                  </div>

                  <div class="grid gap-3 sm:grid-cols-2">
                    <div
                      class="rounded-xl border border-slate-800 bg-slate-900/50 p-3 space-y-1.5"
                    >
                      <div class="flex items-center gap-2">
                        <div
                          class="h-7 w-7 rounded-lg bg-sky-500/10 border border-sky-500/30 flex items-center justify-center"
                        >
                          <span class="text-sky-400 text-sm">1</span>
                        </div>
                        <span class="text-xs font-medium text-slate-200"
                          >Copy from Self-Service</span
                        >
                      </div>
                      <p class="text-[11px] text-slate-400">
                        Go to:
                        <span class="font-medium text-slate-200"
                          >Self-Service &gt; List mode</span
                        >
                        &gt;
                        <span class="font-medium text-slate-200"
                          >Ctrl+A &gt; Ctrl+C &gt; Paste below</span
                        >.
                      </p>
                    </div>

                    <div
                      class="rounded-xl border border-slate-800 bg-slate-900/50 p-3 space-y-1.5"
                    >
                      <div class="flex items-center gap-2">
                        <div
                          class="h-7 w-7 rounded-lg bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center"
                        >
                          <span class="text-emerald-400 text-sm">2</span>
                        </div>
                        <span class="text-xs font-medium text-slate-200"
                          >Adjust styles & download</span
                        >
                      </div>
                      <p class="text-[11px] text-slate-400">
                        Tweak colors, background, and time settings to match
                        your aesthetic, then download as high-res image.
                      </p>
                    </div>
                  </div>

                  <div
                    class="rounded-xl border border-slate-800 bg-slate-950/80 px-3 py-2.5 flex items-center justify-between gap-3"
                  >
                    <div class="flex items-center gap-2">
                      <div
                        class="h-8 w-8 rounded-lg bg-slate-900 border border-slate-700 flex items-center justify-center"
                      >
                        <svg
                          class="w-4 h-4 text-slate-300"
                          viewBox="0 0 20 20"
                          fill="none"
                          aria-hidden="true"
                        >
                          <path
                            d="M4.167 10C4.167 6.778 6.778 4.167 10 4.167C13.222 4.167 15.833 6.778 15.833 10C15.833 13.222 13.222 15.833 10 15.833C6.778 15.833 4.167 13.222 4.167 10Z"
                            stroke="currentColor"
                            stroke-width="1.3"
                          />
                          <path
                            d="M10 7.5V10.417L12 12"
                            stroke="currentColor"
                            stroke-width="1.3"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                        </svg>
                      </div>
                      <div>
                        <p class="text-xs font-medium text-slate-200">
                          Reminder: This generator works best on desktop.
                        </p>
                        <p class="text-[11px] text-slate-400">
                          On mobile, downloading images may fail. For the best
                          experience, please use a computer.
                        </p>
                      </div>
                    </div>
                    <button
                      type="button"
                      onclick="resetForm()"
                      class="hidden sm:inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900 px-2.5 py-1.5 text-[11px] font-medium text-slate-200 hover:bg-slate-800 transition-colors"
                    >
                      Reset all
                    </button>
                  </div>
                </div>
              </div>

              <!-- Save / Load panel -->
              <div
                class="rounded-2xl border border-slate-800 bg-slate-900/80 p-3 space-y-3"
              >
                <div class="flex items-center justify-between gap-2">
                  <h3 class="text-xs font-semibold text-slate-200">
                    Save & load timetables
                  </h3>
                  <span
                    class="inline-flex items-center gap-1 rounded-full bg-sky-500/10 px-2 py-0.5 text-[10px] font-medium text-sky-300 border border-sky-500/30"
                  >
                    New
                  </span>
                </div>
                <p class="text-[11px] text-slate-400">
                  Save your pasted Self-Service text as a backup. You can load
                  it back later without going to Self-Service again.
                </p>

                <div class="grid gap-2 sm:grid-cols-2">
                  <button
                    type="button"
                    onclick="saveCurrentTimetable()"
                    class="inline-flex items-center justify-center gap-1.5 rounded-xl border border-sky-500/40 bg-sky-500/10 px-3 py-2 text-[11px] font-medium text-sky-100 hover:bg-sky-500/15 transition-colors"
                  >
                    <svg
                      class="w-3.5 h-3.5"
                      viewBox="0 0 20 20"
                      fill="none"
                      aria-hidden="true"
                    >
                      <path
                        d="M5 11.5L10 16.5L15 11.5M10 3.5V16.5"
                        stroke="currentColor"
                        stroke-width="1.4"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    Save current text
                  </button>

                  <button
                    type="button"
                    onclick="loadSavedTimetable()"
                    class="inline-flex items-center justify-center gap-1.5 rounded-xl border border-slate-700 bg-slate-900 px-3 py-2 text-[11px] font-medium text-slate-100 hover:bg-slate-800 transition-colors"
                  >
                    <svg
                      class="w-3.5 h-3.5"
                      viewBox="0 0 20 20"
                      fill="none"
                      aria-hidden="true"
                    >
                      <path
                        d="M5 8.5L10 3.5L15 8.5M10 16.5V3.5"
                        stroke="currentColor"
                        stroke-width="1.4"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    Load saved text
                  </button>
                </div>

                <div id="saveStatus" class="text-[11px] text-slate-400"></div>
              </div>

              <!-- Paste area -->
              <div
                class="rounded-2xl border border-slate-800 bg-slate-900/80 p-3 space-y-2"
              >
                <div class="flex items-center justify-between gap-2">
                  <h3 class="text-xs font-semibold text-slate-200">
                    1. Paste your Self-Service timetable
                  </h3>
                  <button
                    type="button"
                    onclick="example()"
                    class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900 px-2 py-1 text-[11px] font-medium text-slate-300 hover:bg-slate-800 transition-colors"
                  >
                    Load example
                  </button>
                </div>
                <textarea
                  id="classDataInput"
                  class="w-full h-40 rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-2 text-xs text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500/60 focus:border-sky-500/60"
                  placeholder="Go to TWC Self-Service > List mode > Ctrl+A > Ctrl+C, then paste here..."
                ></textarea>
                <p class="text-[11px] text-slate-400">
                  Make sure you are in
                  <span class="font-medium text-slate-200"
                    >list mode (not grid mode)</span
                  >
                  when copying. Include all classes for the best result.
                </p>
              </div>

              <!-- Class filters -->
              <div
                class="rounded-2xl border border-slate-800 bg-slate-900/80 p-3 space-y-2"
              >
                <div class="flex items-center justify-between gap-2">
                  <h3 class="text-xs font-semibold text-slate-200">
                    2. Class display options
                  </h3>
                  <button
                    type="button"
                    onclick="generateTimetable()"
                    class="inline-flex items-center gap-1.5 rounded-full bg-sky-500 px-3 py-1.5 text-[11px] font-medium text-slate-950 hover:bg-sky-400 transition-colors"
                  >
                    Generate timetable
                    <svg
                      class="w-3.5 h-3.5"
                      viewBox="0 0 20 20"
                      fill="none"
                      aria-hidden="true"
                    >
                      <path
                        d="M5 10H15M15 10L11 6M15 10L11 14"
                        stroke="currentColor"
                        stroke-width="1.4"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                </div>

                <div
                  class="flex flex-wrap items-center gap-2 text-[11px] text-slate-300"
                >
                  <label class="inline-flex items-center gap-1">
                    <input
                      type="checkbox"
                      id="hideOnline"
                      class="rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500/60"
                    />
                    Hide
                    <span class="font-medium text-slate-100">online</span>
                    classes
                  </label>
                  <label class="inline-flex items-center gap-1">
                    <input
                      type="checkbox"
                      id="hideTutorials"
                      class="rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500/60"
                    />
                    Hide
                    <span class="font-medium text-slate-100">tutorials</span>
                  </label>
                  <label class="inline-flex items-center gap-1">
                    <input
                      type="checkbox"
                      id="hideSatSun"
                      class="rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500/60"
                    />
                    Hide
                    <span class="font-medium text-slate-100">Sat/Sun</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Right: Preview & controls -->
            <div class="space-y-3">
              <!-- Timetable preview card -->
              <div
                class="rounded-2xl border border-slate-800 bg-slate-900/80 p-3 space-y-3"
              >
                <div class="flex items-center justify-between gap-2">
                  <div>
                    <h3 class="text-xs font-semibold text-slate-200">
                      3. Timetable preview
                    </h3>
                    <p class="text-[11px] text-slate-400">
                      When enabled, you can click and drag inside the timetable
                      preview to move the background picture.
                    </p>
                  </div>
                  <div class="flex items-center gap-1.5">
                    <label
                      class="inline-flex items-center gap-1.5 text-[11px] text-slate-300"
                    >
                      <input
                        type="checkbox"
                        id="enableDrag"
                        class="rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500/60"
                        checked
                      />
                      Enable drag
                    </label>
                    <button
                      type="button"
                      onclick="resetBackgroundPosition()"
                      class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900 px-2 py-1 text-[11px] text-slate-300 hover:bg-slate-800 transition-colors"
                    >
                      Reset
                    </button>
                  </div>
                </div>

                <!-- Preview area -->
                <div class="flex flex-col items-center gap-2">
                  <div
                    id="timetablePreviewContainer"
                    class="relative w-full max-w-xs aspect-[9/16] rounded-2xl border border-slate-800 bg-slate-950 overflow-hidden"
                  >
                    <!-- Background image -->
                    <div
                      id="backgroundImage"
                      class="absolute inset-0 bg-center bg-cover draggable-background"
                      style="
                        background-image: url('https://images.pexels.com/photos/1072179/pexels-photo-1072179.jpeg?auto=compress&cs=tinysrgb&w=1200');
                        transform: translate(0px, 0px);
                      "
                    ></div>

                    <!-- Dim overlay -->
                    <div
                      id="backgroundOverlay"
                      class="absolute inset-0 bg-slate-950/50"
                    ></div>

                    <!-- Timetable content -->
                    <div
                      id="timetablePreview"
                      class="relative w-full h-full flex flex-col p-2"
                    >
                      <!-- Top bar with profile & name -->
                      <div class="flex items-center justify-between mb-1.5">
                        <div class="flex items-center gap-1.5">
                          <div
                            class="h-5 w-5 rounded-full bg-slate-800 border border-slate-600 flex items-center justify-center"
                          >
                            <span class="text-[10px] font-medium text-slate-300">
                              TT
                            </span>
                          </div>
                          <div class="flex flex-col leading-tight">
                            <span
                              id="studentName"
                              class="text-[11px] font-semibold text-slate-50"
                              >Your Name</span
                            >
                            <span
                              id="studentId"
                              class="text-[9px] text-slate-300"
                              >12345678</span
                            >
                          </div>
                        </div>
                        <div
                          class="flex items-center gap-1.5 text-[9px] text-slate-300"
                        >
                          <span
                            id="semesterLabel"
                            class="px-1.5 py-0.5 rounded-full bg-slate-900/80 border border-slate-700/70"
                            >2024-25 Sem 2</span
                          >
                          <span
                            class="inline-flex items-center justify-center h-4 w-4 rounded-full bg-slate-900/80 border border-slate-700/70"
                          >
                            <svg
                              class="w-2.5 h-2.5 text-slate-300"
                              viewBox="0 0 20 20"
                              fill="none"
                              aria-hidden="true"
                            >
                              <path
                                d="M10 4.167C7.7 4.167 5.833 6.033 5.833 8.333C5.833 11.25 10 15.833 10 15.833C10 15.833 14.167 11.25 14.167 8.333C14.167 6.033 12.3 4.167 10 4.167ZM10 10C9.07953 10 8.33333 9.25381 8.33333 8.33333C8.33333 7.41286 9.07953 6.66667 10 6.66667C10.9205 6.66667 11.6667 7.41286 11.6667 8.33333C11.6667 9.25381 10.9205 10 10 10Z"
                                fill="currentColor"
                              />
                            </svg>
                          </span>
                        </div>
                      </div>

                      <!-- Day labels -->
                      <div class="grid grid-cols-5 gap-0.5 mb-1.5 text-[9px]">
                        <div
                          class="text-center text-slate-400 font-medium leading-tight"
                        >
                          Mon
                        </div>
                        <div
                          class="text-center text-slate-400 font-medium leading-tight"
                        >
                          Tue
                        </div>
                        <div
                          class="text-center text-slate-400 font-medium leading-tight"
                        >
                          Wed
                        </div>
                        <div
                          class="text-center text-slate-400 font-medium leading-tight"
                        >
                          Thu
                        </div>
                        <div
                          class="text-center text-slate-400 font-medium leading-tight"
                        >
                          Fri
                        </div>
                      </div>

                      <!-- Timetable grid -->
                      <div class="flex-1 grid grid-cols-5 gap-0.5">
                        <!-- The JS will fill this -->
                      </div>
                    </div>
                  </div>

                  <p class="text-[11px] text-slate-400 text-center">
                    Your timetable will be displayed here.
                  </p>
                </div>
              </div>

              <!-- Style controls -->
              <div
                class="rounded-2xl border border-slate-800 bg-slate-900/80 p-3 space-y-3"
              >
                <div class="flex items-center justify-between gap-2">
                  <h3 class="text-xs font-semibold text-slate-200">
                    4. Style & layout controls
                  </h3>
                  <button
                    type="button"
                    onclick="downloadTimetable()"
                    class="inline-flex items-center gap-1.5 rounded-full bg-emerald-500 px-3 py-1.5 text-[11px] font-medium text-slate-950 hover:bg-emerald-400 transition-colors"
                  >
                    Download image
                    <svg
                      class="w-3.5 h-3.5"
                      viewBox="0 0 20 20"
                      fill="none"
                      aria-hidden="true"
                    >
                      <path
                        d="M5 10.8333L10 15.8333L15 10.8333M10 4.16666V15.8333"
                        stroke="currentColor"
                        stroke-width="1.4"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                </div>

                <!-- Background & overlay -->
                <div class="space-y-2">
                  <div class="flex items-center justify-between gap-2">
                    <span class="text-[11px] text-slate-300"
                      >Background image URL</span
                    >
                    <button
                      type="button"
                      onclick="useDefaultBackground()"
                      class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900 px-2 py-1 text-[11px] text-slate-300 hover:bg-slate-800 transition-colors"
                    >
                      Use default
                    </button>
                  </div>
                  <input
                    type="text"
                    id="backgroundUrl"
                    class="w-full rounded-xl border border-slate-700 bg-slate-950/80 px-3 py-1.5 text-xs text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500/60 focus:border-sky-500/60"
                    placeholder="Paste image URL (e.g. from Pinterest, Unsplash, Pexels)"
                    oninput="updateBackgroundImage()"
                  />

                  <div class="grid grid-cols-8 gap-1 mt-1">
                    <!-- Reference image buttons -->
                    <button
                      type="button"
                      onclick="setReferenceImage(1)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://i.ibb.co/VYj39Sw/IMG-0007.jpg')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                    <button
                      type="button"
                      onclick="setReferenceImage(2)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://images.pexels.com/photos/531880/pexels-photo-531880.jpeg?auto=compress&cs=tinysrgb&w=1200')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                    <button
                      type="button"
                      onclick="setReferenceImage(3)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://images.pexels.com/photos/1072179/pexels-photo-1072179.jpeg?auto=compress&cs=tinysrgb&w=1200')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                    <button
                      type="button"
                      onclick="setReferenceImage(4)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://images.pexels.com/photos/2151/sky-sunny-clouds-cloudy.jpg?auto=compress&cs=tinysrgb&w=1200')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                    <button
                      type="button"
                      onclick="setReferenceImage(5)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://images.pexels.com/photos/5726976/pexels-photo-5726976.jpeg?auto=compress&cs=tinysrgb&w=1200')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                    <button
                      type="button"
                      onclick="setReferenceImage(6)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://images.pexels.com/photos/2589650/pexels-photo-2589650.jpeg?auto=compress&cs=tinysrgb&w=1200')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                    <button
                      type="button"
                      onclick="setReferenceImage(7)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://images.pexels.com/photos/3601453/pexels-photo-3601453.jpeg?auto=compress&cs=tinysrgb&w=1200')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                    <button
                      type="button"
                      onclick="setReferenceImage(8)"
                      class="h-7 rounded-lg border border-slate-700 bg-[url('https://images.pexels.com/photos/5380655/pexels-photo-5380655.jpeg?auto=compress&cs=tinysrgb&w=1200')] bg-cover bg-center hover:ring-2 hover:ring-sky-500/60 transition-all"
                    ></button>
                  </div>
                </div>

                <!-- Overlay darkness -->
                <div class="space-y-1.5">
                  <div class="flex items-center justify-between">
                    <span class="text-[11px] text-slate-300"
                      >Background darkness</span
                    >
                    <span
                      id="overlayOpacityValue"
                      class="text-[11px] text-slate-400"
                      >50%</span
                    >
                  </div>
                  <input
                    type="range"
                    id="overlayOpacity"
                    min="0"
                    max="100"
                    value="50"
                    class="slider"
                    oninput="updateOverlayOpacity()"
                  />
                </div>

                <!-- Timetable vertical shift -->
                <div class="space-y-1.5">
                  <div class="flex items-center justify-between">
                    <span class="text-[11px] text-slate-300"
                      >Shift timetable downward</span
                    >
                    <span
                      id="verticalShiftValue"
                      class="text-[11px] text-slate-400"
                      >0px</span
                    >
                  </div>
                  <input
                    type="range"
                    id="verticalShift"
                    min="-40"
                    max="80"
                    value="0"
                    class="slider"
                    oninput="updateVerticalShift()"
                  />
                </div>

                <!-- Line spacing control -->
                <div class="space-y-1.5">
                  <div class="flex items-center justify-between">
                    <span class="text-[11px] text-slate-300"
                      >Line spacing</span
                    >
                    <span
                      id="lineSpacingValue"
                      class="text-[11px] text-slate-400"
                      >1.0x</span
                    >
                  </div>
                  <input
                    type="range"
                    id="lineSpacing"
                    min="8"
                    max="14"
                    step="1"
                    value="10"
                    class="slider"
                    oninput="updateLineSpacing()"
                  />
                </div>

                <!-- Font size control -->
                <div class="space-y-1.5">
                  <div class="flex items-center justify-between">
                    <span class="text-[11px] text-slate-300">Font size</span>
                    <span
                      id="fontSizeValue"
                      class="text-[11px] text-slate-400"
                      >11px</span
                    >
                  </div>
                  <input
                    type="range"
                    id="fontSizeSlider"
                    min="8"
                    max="14"
                    value="11"
                    class="slider"
                    oninput="updateFontSize()"
                  />
                </div>

                <!-- Time range controls -->
                <div class="grid grid-cols-2 gap-2 pt-1 border-t border-slate-800">
                  <div class="space-y-1.5">
                    <div class="flex items-center justify-between">
                      <span class="text-[11px] text-slate-300"
                        >Start time</span
                      >
                      <span
                        id="startTimeValue"
                        class="text-[11px] text-slate-400"
                        >09:00</span
                      >
                    </div>
                    <input
                      type="range"
                      id="startTimeSlider"
                      min="7"
                      max="12"
                      value="9"
                      class="slider"
                      oninput="updateTimeRange()"
                    />
                  </div>
                  <div class="space-y-1.5">
                    <div class="flex items-center justify-between">
                      <span class="text-[11px] text-slate-300">End time</span>
                      <span
                        id="endTimeValue"
                        class="text-[11px] text-slate-400"
                        >18:00</span
                      >
                    </div>
                    <input
                      type="range"
                      id="endTimeSlider"
                      min="15"
                      max="22"
                      value="18"
                      class="slider"
                      oninput="updateTimeRange()"
                    />
                  </div>
                </div>
              </div>

              <!-- Error / info messages -->
              <div
                id="errorMessage"
                class="hidden rounded-xl border border-rose-500/40 bg-rose-500/10 px-3 py-2 text-[11px] text-rose-100"
              ></div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <script>
      const dayOrder = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
      let currentFontSize = 11;
      let currentStartHour = 9;
      let currentEndHour = 18;
      let savedTimetableText = "";
      let isBackgroundDragging = false;
      let dragStart = { x: 0, y: 0 };
      let backgroundPosition = { x: 0, y: 0 };

      function resetForm() {
        document.getElementById("classDataInput").value = "";
        document.getElementById("hideOnline").checked = false;
        document.getElementById("hideTutorials").checked = false;
        document.getElementById("hideSatSun").checked = false;

        document.getElementById("overlayOpacity").value = 50;
        document.getElementById("overlayOpacityValue").textContent = "50%";
        updateOverlayOpacity();

        document.getElementById("verticalShift").value = 0;
        document.getElementById("verticalShiftValue").textContent = "0px";
        updateVerticalShift();

        document.getElementById("lineSpacing").value = 10;
        document.getElementById("lineSpacingValue").textContent = "1.0x";
        updateLineSpacing();

        document.getElementById("fontSizeSlider").value = 11;
        document.getElementById("fontSizeValue").textContent = "11px";
        currentFontSize = 11;
        updateFontSize();

        document.getElementById("startTimeSlider").value = 9;
        document.getElementById("endTimeSlider").value = 18;
        document.getElementById("startTimeValue").textContent = "09:00";
        document.getElementById("endTimeValue").textContent = "18:00";
        currentStartHour = 9;
        currentEndHour = 18;

        document.getElementById("backgroundUrl").value = "";
        useDefaultBackground();

        document.getElementById("studentName").textContent = "Your Name";
        document.getElementById("studentId").textContent = "12345678";
        document.getElementById("semesterLabel").textContent = "2024-25 Sem 2";

        document.getElementById("errorMessage").classList.add("hidden");
        document.getElementById("errorMessage").textContent = "";

        const grid = document.querySelector(
          "#timetablePreview .grid.grid-cols-5"
        );
        if (grid) {
          grid.innerHTML = "";
        }
      }

      function example() {
        const exampleText = `TERM SESSION GRADE
        FACULTY OF ARTS
        Course Name 1 LAB  01  3.00   Mon 09:00AM-10:15AM  Room A101  Instructor A
        Course Name 1 LEC  02  3.00   Wed 02:00PM-03:15PM  Room A202  Instructor B
        Course Name 2 TUT  01  3.00   Tue 10:30AM-11:45AM  Room B303  Instructor C
        Course Name 3 LEC  01  3.00   Thu 01:00PM-02:15PM  Room C404  Instructor D
        Course Name 4 LEC  01  3.00   Fri 11:00AM-12:15PM  Room D505  Instructor E
        Course Name 5 LEC  01  3.00   Sat 09:00AM-10:15AM  Room E606  Instructor F
        Course Name 6 LEC  01  3.00   Sun 03:00PM-04:15PM  Room F707  Instructor G`;

        document.getElementById("classDataInput").value = exampleText;
      }

      function parseClassData(rawText) {
        const lines = rawText
          .split("\n")
          .map((line) => line.trim())
          .filter((line) => line.length > 0);

        const classes = [];

        for (const line of lines) {
          if (!/\bMon\b|\bTue\b|\bWed\b|\bThu\b|\bFri\b|\bSat\b|\bSun\b/.test(line))
            continue;

          const dayMatch = line.match(
            /\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b\s+(\d{1,2}:\d{2})(AM|PM)-(\d{1,2}:\d{2})(AM|PM)/
          );
          if (!dayMatch) continue;

          const day = dayMatch[1];
          const startTimeStr = dayMatch[2] + dayMatch[3];
          const endTimeStr = dayMatch[4] + dayMatch[5];

          const typeMatch = line.match(/\b(LEC|LAB|TUT)\b/);
          const type = typeMatch ? typeMatch[1] : "LEC";

          const timeIndex = line.indexOf(dayMatch[0]);
          const beforeTime = line.slice(0, timeIndex).trim();
          const tokens = beforeTime.split(/\s+/);

          let courseCode = "";
          let section = "";
          let credits = "";

          const creditIndex = tokens.findIndex((t) => /^\d+(\.\d+)?$/.test(t));
          if (creditIndex !== -1) {
            credits = tokens[creditIndex];
            const secIndex = creditIndex - 1;
            const typeIndex = tokens.findIndex((t) =>
              /^(LEC|LAB|TUT)$/.test(t)
            );
            if (typeIndex !== -1 && secIndex === typeIndex + 1) {
              section = tokens[secIndex];
              courseCode = tokens[typeIndex - 1];
            } else {
              const lastThree = tokens.slice(-3);
              courseCode = lastThree[0] || "";
              section = lastThree[1] || "";
            }
          } else {
            const typeIdx = tokens.findIndex((t) => /^(LEC|LAB|TUT)$/.test(t));
            if (typeIdx >= 2) {
              courseCode = tokens[typeIdx - 1];
              section = tokens[typeIdx + 1] || "";
            }
          }

          const titleTokens = tokens.filter(
            (t) => t !== courseCode && t !== section && t !== credits && t !== type
          );
          const courseTitle = titleTokens.join(" ");

          const roomMatch = line.slice(timeIndex + dayMatch[0].length).match(/\s+([A-Za-z0-9]+)\s+/);
          const room = roomMatch ? roomMatch[1] : "";

          classes.push({
            day,
            startTimeStr,
            endTimeStr,
            type,
            courseCode,
            section,
            credits,
            courseTitle,
            room,
          });
        }

        return classes;
      }

      function timeStringToMinutes(t) {
        const match = t.match(/(\d{1,2}):(\d{2})(AM|PM)/);
        if (!match) return null;

        let hour = parseInt(match[1], 10);
        const minute = parseInt(match[2], 10);
        const ampm = match[3];

        if (ampm === "PM" && hour !== 12) {
          hour += 12;
        }
        if (ampm === "AM" && hour === 12) {
          hour = 0;
        }

        return hour * 60 + minute;
      }

      function filterClasses(classes) {
        const hideOnline = document.getElementById("hideOnline").checked;
        const hideTutorials = document.getElementById("hideTutorials").checked;
        const hideSatSun = document.getElementById("hideSatSun").checked;

        return classes.filter((cls) => {
          if (hideOnline && cls.room && cls.room.toLowerCase().includes("online")) {
            return false;
          }

          if (hideTutorials && cls.type === "TUT") {
            return false;
          }

          if (hideSatSun && (cls.day === "Sat" || cls.day === "Sun")) {
            return false;
          }

          const startMinutes = timeStringToMinutes(cls.startTimeStr);
          const endMinutes = timeStringToMinutes(cls.endTimeStr);
          if (startMinutes === null || endMinutes === null) return false;

          const startHour = startMinutes / 60;
          const endHour = endMinutes / 60;
          return (
            startHour >= currentStartHour &&
            endHour <= currentEndHour &&
            startHour < endHour
          );
        });
      }

      function generateTimetable() {
        const rawText = document.getElementById("classDataInput").value;
        const errorEl = document.getElementById("errorMessage");

        errorEl.classList.add("hidden");
        errorEl.textContent = "";

        if (!rawText.trim()) {
          errorEl.textContent =
            "Please paste your Self-Service timetable text first.";
          errorEl.classList.remove("hidden");
          return;
        }

        const classes = parseClassData(rawText);
        if (classes.length === 0) {
          errorEl.textContent =
            "No valid classes found. Make sure the text is from Self-Service list mode.";
          errorEl.classList.remove("hidden");
          return;
        }

        const filteredClasses = filterClasses(classes);

        const grid = document.querySelector(
          "#timetablePreview .grid.grid-cols-5"
        );
        if (!grid) return;
        grid.innerHTML = "";

        for (let i = 0; i < 5; i++) {
          const dayCol = document.createElement("div");
          dayCol.className = "relative flex flex-col gap-0.5";
          dayCol.style.minHeight = "100%";
          grid.appendChild(dayCol);
        }

        const maxSlots = (currentEndHour - currentStartHour) * 2;

        for (const cls of filteredClasses) {
          const dayIndex = dayOrder.indexOf(cls.day);
          if (dayIndex < 0 || dayIndex > 4) continue;

          const col = grid.children[dayIndex];
          if (!col) continue;

          const startMin = timeStringToMinutes(cls.startTimeStr);
          const endMin = timeStringToMinutes(cls.endTimeStr);
          const startSlot = (startMin / 60 - currentStartHour) * 2;
          const endSlot = (endMin / 60 - currentStartHour) * 2;
          const durationSlots = endSlot - startSlot;

          if (durationSlots <= 0 || startSlot < 0 || endSlot > maxSlots) {
            continue;
          }

          const topPercent = (startSlot / maxSlots) * 100;
          const heightPercent = (durationSlots / maxSlots) * 100;

          const block = document.createElement("div");
          block.className =
            "absolute left-0 right-0 rounded-md bg-sky-500/20 border border-sky-400/40 px-0.5 py-0.5 flex flex-col gap-0.5 overflow-hidden";

          block.style.top = topPercent + "%";
          block.style.height = heightPercent + "%";
          block.style.fontSize = currentFontSize + "px";
          block.style.lineHeight = "1.1";

          const timeLabel = document.createElement("p");
          timeLabel.className =
            "text-[10px] text-sky-100/90 font-medium leading-tight";
          timeLabel.textContent =
            cls.startTimeStr + " - " + cls.endTimeStr;

          const title = document.createElement("p");
          title.className = "font-bold text-[11px] leading-tight";
          title.textContent = cls.courseTitle;

          const codeLine = document.createElement("p");
          codeLine.className = "text-[9px] text-sky-100/95 leading-tight";
          codeLine.textContent = `${cls.courseCode} ${cls.type} ${cls.section}`;

          const roomLine = document.createElement("p");
          roomLine.className = "text-[9px] text-slate-100/90 leading-tight";
          roomLine.textContent = cls.room || "";

          block.appendChild(timeLabel);
          block.appendChild(title);
          block.appendChild(codeLine);
          block.appendChild(roomLine);

          col.appendChild(block);
        }
      }

      function updateOverlayOpacity() {
        const slider = document.getElementById("overlayOpacity");
        const value = parseInt(slider.value, 10);
        const overlay = document.getElementById("backgroundOverlay");

        const opacity = value / 100;
        overlay.style.backgroundColor = `rgba(15, 23, 42, ${opacity})`;
        document.getElementById("overlayOpacityValue").textContent =
          value + "%";
      }

      function updateVerticalShift() {
        const slider = document.getElementById("verticalShift");
        const px = parseInt(slider.value, 10);
        const preview = document.getElementById("timetablePreview");
        preview.style.transform = `translateY(${px}px)`;
        document.getElementById("verticalShiftValue").textContent = px + "px";
      }

      function updateLineSpacing() {
        const slider = document.getElementById("lineSpacing");
        const value = parseInt(slider.value, 10);
        const multiplier = value / 10;
        document.getElementById("lineSpacingValue").textContent =
          multiplier.toFixed(1) + "x";

        const preview = document.getElementById("timetablePreview");
        preview.style.lineHeight = multiplier.toString();
      }

      function updateFontSize() {
        const slider = document.getElementById("fontSizeSlider");
        currentFontSize = parseInt(slider.value, 10);
        document.getElementById("fontSizeValue").textContent =
          currentFontSize + "px";

        const blocks = document.querySelectorAll(
          "#timetablePreview .absolute.rounded-md"
        );
        blocks.forEach((block) => {
          block.style.fontSize = currentFontSize + "px";
        });
      }

      function updateTimeRange() {
        const startSlider = document.getElementById("startTimeSlider");
        const endSlider = document.getElementById("endTimeSlider");

        let startHour = parseInt(startSlider.value, 10);
        let endHour = parseInt(endSlider.value, 10);

        if (startHour >= endHour) {
          if (startSlider === document.activeElement) {
            endHour = startHour + 1;
            if (endHour > parseInt(endSlider.max, 10)) {
              endHour = parseInt(endSlider.max, 10);
              startHour = endHour - 1;
            }
          } else {
            startHour = endHour - 1;
            if (startHour < parseInt(startSlider.min, 10)) {
              startHour = parseInt(startSlider.min, 10);
              endHour = startHour + 1;
            }
          }
        }

        startSlider.value = startHour;
        endSlider.value = endHour;

        currentStartHour = startHour;
        currentEndHour = endHour;

        document.getElementById("startTimeValue").textContent =
          (startHour < 10 ? "0" : "") + startHour + ":00";
        document.getElementById("endTimeValue").textContent =
          (endHour < 10 ? "0" : "") + endHour + ":00";

        generateTimetable();
      }

      function useDefaultBackground() {
        const bg = document.getElementById("backgroundImage");
        bg.style.backgroundImage =
          "url('https://images.pexels.com/photos/1072179/pexels-photo-1072179.jpeg?auto=compress&cs=tinysrgb&w=1200')";
        bg.style.transform = "translate(0px, 0px)";
        backgroundPosition = { x: 0, y: 0 };
        document.getElementById("backgroundUrl").value = "";
      }

      function updateBackgroundImage() {
        const url = document.getElementById("backgroundUrl").value.trim();
        const bg = document.getElementById("backgroundImage");
        if (url) {
          bg.style.backgroundImage = `url('${url}')`;
        } else {
          useDefaultBackground();
        }
      }

      function setReferenceImage(index) {
        const urls = [
          "https://i.ibb.co/VYj39Sw/IMG-0007.jpg",
          "https://images.pexels.com/photos/531880/pexels-photo-531880.jpeg?auto=compress&cs=tinysrgb&w=1200",
          "https://images.pexels.com/photos/1072179/pexels-photo-1072179.jpeg?auto=compress&cs=tinysrgb&w=1200",
          "https://images.pexels.com/photos/2151/sky-sunny-clouds-cloudy.jpg?auto=compress&cs=tinysrgb&w=1200",
          "https://images.pexels.com/photos/5726976/pexels-photo-5726976.jpeg?auto=compress&cs=tinysrgb&w=1200",
          "https://images.pexels.com/photos/2589650/pexels-photo-2589650.jpeg?auto=compress&cs=tinysrgb&w=1200",
          "https://images.pexels.com/photos/3601453/pexels-photo-3601453.jpeg?auto=compress&cs=tinysrgb&w=1200",
          "https://images.pexels.com/photos/5380655/pexels-photo-5380655.jpeg?auto=compress&cs=tinysrgb&w=1200",
        ];
        const idx = index - 1;
        if (urls[idx]) {
          const bg = document.getElementById("backgroundImage");
          bg.style.backgroundImage = `url('${urls[idx]}')`;
          bg.style.transform = "translate(0px, 0px)";
          backgroundPosition = { x: 0, y: 0 };
          document.getElementById("backgroundUrl").value = urls[idx];
        }
      }

      function resetBackgroundPosition() {
        const bg = document.getElementById("backgroundImage");
        bg.style.transform = "translate(0px, 0px)";
        backgroundPosition = { x: 0, y: 0 };
      }

      function initBackgroundDrag() {
        const bg = document.getElementById("backgroundImage");
        const enableDragCheckbox = document.getElementById("enableDrag");

        function onMouseDown(e) {
          if (!enableDragCheckbox.checked) return;
          isBackgroundDragging = true;
          dragStart = { x: e.clientX, y: e.clientY };
          bg.style.cursor = "grabbing";
        }

        function onMouseMove(e) {
          if (!isBackgroundDragging) return;
          const dx = e.clientX - dragStart.x;
          const dy = e.clientY - dragStart.y;
          const newX = backgroundPosition.x + dx;
          const newY = backgroundPosition.y + dy;
          bg.style.transform = `translate(${newX}px, ${newY}px)`;
        }

        function onMouseUp() {
          if (!isBackgroundDragging) return;
          const transform = bg.style.transform;
          const match = transform.match(
            /translate\((-?\d+(?:\.\d+)?)px,\s*(-?\d+(?:\.\d+)?)px\)/
          );
          if (match) {
            backgroundPosition = {
              x: parseFloat(match[1]),
              y: parseFloat(match[2]),
            };
          }
          isBackgroundDragging = false;
          bg.style.cursor = "grab";
        }

        bg.addEventListener("mousedown", onMouseDown);
        window.addEventListener("mousemove", onMouseMove);
        window.addEventListener("mouseup", onMouseUp);
      }

      function downloadTimetable() {
        const previewContainer = document.getElementById(
          "timetablePreviewContainer"
        );
        const enableDragCheckbox = document.getElementById("enableDrag");

        const wasDraggingEnabled = enableDragCheckbox.checked;
        enableDragCheckbox.checked = false;
        document
          .getElementById("backgroundImage")
          .classList.remove("draggable-background");

        const scale = 3;
        const width = previewContainer.clientWidth;
        const height = previewContainer.clientHeight;

        html2canvas(previewContainer, {
          scale: scale,
          width: width,
          height: height,
          backgroundColor: null,
          useCORS: true,
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "timetable.png";
          link.href = canvas.toDataURL("image/png");
          link.click();

          if (wasDraggingEnabled) {
            enableDragCheckbox.checked = true;
            document
              .getElementById("backgroundImage")
              .classList.add("draggable-background");
          }
        });
      }

      function saveCurrentTimetable() {
        const text = document.getElementById("classDataInput").value.trim();
        const statusEl = document.getElementById("saveStatus");

        if (!text) {
          statusEl.textContent = "Nothing to save. Paste your timetable first.";
          statusEl.className = "text-[11px] text-amber-300";
          return;
        }

        try {
          localStorage.setItem("ttbSavedTimetable", text);
          savedTimetableText = text;
          statusEl.textContent =
            "Timetable saved locally. You can load it later on this device.";
          statusEl.className = "text-[11px] text-emerald-300";
        } catch (e) {
          statusEl.textContent =
            "Failed to save. Your browser might be blocking local storage.";
          statusEl.className = "text-[11px] text-rose-300";
        }
      }

      function loadSavedTimetable() {
        const statusEl = document.getElementById("saveStatus");
        try {
          const saved = localStorage.getItem("ttbSavedTimetable");
          if (!saved) {
            statusEl.textContent =
              "No saved timetable found. Save one first.";
            statusEl.className = "text-[11px] text-amber-300";
            return;
          }
          document.getElementById("classDataInput").value = saved;
          savedTimetableText = saved;
          statusEl.textContent = "Saved timetable loaded.";
          statusEl.className = "text-[11px] text-emerald-300";
        } catch (e) {
          statusEl.textContent =
            "Failed to load saved timetable. Your browser might be blocking local storage.";
          statusEl.className = "text-[11px] text-rose-300";
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        updateOverlayOpacity();
        updateVerticalShift();
        updateLineSpacing();
        updateFontSize();
        updateTimeRange();
        initBackgroundDrag();

        try {
          const saved = localStorage.getItem("ttbSavedTimetable");
          if (saved) {
            savedTimetableText = saved;
            document.getElementById("saveStatus").textContent =
              "Found a previously saved timetable. Click 'Load saved text' to use it.";
            document.getElementById("saveStatus").className =
              "text-[11px] text-slate-300";
          }
        } catch (e) {}
      });
    </script>
  </body>
</html>
